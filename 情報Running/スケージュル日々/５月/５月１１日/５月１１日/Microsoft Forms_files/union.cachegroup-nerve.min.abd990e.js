(self.webpackChunk=self.webpackChunk||[]).push([[5527],{41293:function(t,n,r){"use strict";function i(t,n){t||(console.assert(t,"Nerve - "+n),s("assert failed: "+n))}function e(t){return s("TODO: "+t)}function u(){return s("to be overridden.")}function o(t){if(t="Nerve - warning: "+t,console.warn(t),c){var n=new Error(t).stack;c(n)}}r.d(n,{hu:function(){return i},ys:function(){return e},ct:function(){return u},ZK:function(){return o},_y:function(){return s}});var c=null;function s(t){throw Error("Nerve - "+t)}},42874:function(t,n,r){"use strict";r.d(n,{k:function(){return e},s:function(){return u}});var i=r(36630),e=function(){return function(t){void 0===t&&(t={}),u(this,t)}}();function u(t,n,r){void 0===r&&(r=!1),(0,i.zO)(t,"__nerve__",n,r)}},39923:function(t,n,r){"use strict";r.d(n,{f4:function(){return h},bn:function(){return a},u9:function(){return v},J4:function(){return w}});var i=r(26203),e=r(41293),u=r(42874),o=r(36630),c="Spec",s=Object.freeze({IsKeyField:!1,IsLocalField:!1,IsNumberTypeInDataSource:!1,IsSourceGenerated:!1});function f(t,n){var r=l();if(i.d.isObjectMasterClass(t))r.masterClassGetter=function(){return t};else{if(!(t instanceof Function))throw Error("The parameter of Spec.fromMasterClass should be a master class of a function.");r.masterClassGetter=t}return d(r,n)}function h(t){var n=t;return n&&n.__nerve__&&n.__nerve__.nerveObjectType===c}function a(t,n){n?Object.keys(n).forEach((function(r){return m(t+r,n[r])})):g(t,"there's no spec passed")}function v(t){return h(t)?t.__nerve__.attributes:s}function l(){return{attributes:s,basicTypeName:null,enumTypeGetter:null,isCollection:!1,isLeaf:!1,keyGetter:null,masterClassGetter:null,nullable:!1,nerveObjectType:c}}function d(t,n){var r={};return b(t,n),(0,u.s)(r,(0,o.fm)(t)),r}function b(t,n){if((n=n||{}).IsKeyField){switch(t.basicTypeName){case"boolean":case"string":case"number":break;default:(0,e._y)('"isKeyField" only supported for basic type fields')}n.IsLocalField&&(0,e._y)("a local field can't be key field.")}var r={IsSourceGenerated:!!n.IsSourceGenerated,IsExpandedField:!!n.IsExpandedField,IsKeyField:!!n.IsKeyField,IsLocalField:!!n.IsLocalField,IsNumberTypeInDataSource:!!n.IsNumberTypeInDataSource,SourceFieldName:n.SourceFieldName};t.attributes=Object.freeze(r)}function m(t,n){n?h(n)?n.__nerve__.isCollection&&m(t+"[0]",n[0]):a(t,n):g(t,"empty field spec")}function g(t,n){throw Error("Spec error of "+t+": "+n+".")}function y(t){return function(n,r){return function(t,n,r){var i=l();return i.isLeaf=!0,i.basicTypeName=t,i.keyGetter=r||null,b(i,n),d(i,n)}(t,n,r)}}var w=Object.freeze({create:function(t,n){var r;return b(r=h(t)?(0,o.kI)(t.__nerve__):l(),n),(0,o.kt)(d(r,n),t)},boolean:y("boolean"),number:y("number"),string:y("string"),enumeration:function(t,n){var r=l();return r.isLeaf=!0,r.basicTypeName="enum",r.enumTypeGetter=t,b(r,n),d(r,n)},reference:y("reference"),collectionOf:function(t,n){var r;r=h(t)?t:i.d.isObjectMasterClass(t)||t instanceof Function?f(t):t;var e=l();e.isCollection=!0;var u=d(e,n);return(0,o.zO)(u,0,r),u},fromMasterClass:f})},36630:function(t,n,r){"use strict";r.d(n,{zO:function(){return e},EA:function(){return u},_x:function(){return o},kt:function(){return c},kI:function(){return s},fm:function(){return f},z2:function(){return h},L:function(){return a},Bx:function(){return v},Ko:function(){return l},uF:function(){return b},uG:function(){return m},Cb:function(){return d},bC:function(){return g},wU:function(){return y},Je:function(){return w},GP:function(){return S}});var i=r(41293);function e(t,n,r,i){void 0===i&&(i=!0),p(t,n,{configurable:!1,enumerable:!!i,value:r,writable:!1})}function u(t,n,r){p(t,n,{configurable:!0,enumerable:!0,get:function(){var i=r();return delete t[n],e(t,n,i),i},set:function(){throw Error("Setting readonly field: "+n)}})}function o(t,n,r,i){p(t,n,{configurable:!1,enumerable:!0,get:r,set:i=i||function(){throw new Error("Setting readonly field: "+n)}})}function c(t,n){var r=t;for(var i in n)r[i]=n[i];return r}function s(t){return c({},t)}function f(t){(0,i.hu)(!Array.isArray(t),"array is not currently supported by readonly().");var n={};for(var r in t)e(n,r,t[r]);return n}function h(t,n){(0,i.hu)(n in t,"the field named "+n+" not been initialized yet."),e(t,n,t[n])}function a(t){return Array.isArray(t)?t:function(t){return t?Array.prototype.slice.apply(t):[]}(t)}function v(t){var n=function(){return Promise.resolve(null)};return t?t.then(n,n):n()}function l(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return new Promise((function(n,r){var i=t.length,e=[];t.forEach((function(t,u){return t.then((function(t){return n(t)})).catch((function(t){e[u]=t,0==--i&&r.apply(void 0,e)}))}))}))}var d,b=function(){function t(t,n){void 0===n&&(n=0),this.t=t,this.i=n}var n=t.prototype;return n.callOnceLater=function(){var t=this;0!==this.i&&null!=this.u&&this.clear(),null==this.u&&(this.u=window.setTimeout((function(){t.callImmediately()}),this.i))},n.flush=function(){null!=this.u&&(this.clear(),this.t())},n.callImmediately=function(){null!=this.u&&this.clear(),this.t()},n.clear=function(){this.u&&(clearTimeout(this.u),this.u=void 0)},t}(),m=function(){function t(t){var n=this;this.o=new Promise((function(r,i){t.then((function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];n.h||r.apply(void 0,t)}),(function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];n.h||i(t)}))}))}var n=t.prototype;return n.promise=function(){return this.o},n.cancel=function(){this.h=!0},t}();!function(t){t[t.Pending=0]="Pending",t[t.Resolved=1]="Resolved",t[t.Rejected=2]="Rejected"}(d||(d={}));var g=function(){function t(t,n){var r=this;void 0===n&&(n=d.Pending),t.then((function(){r.v=d.Resolved}),(function(){r.v=d.Rejected})),this.l=t,this.v=n}var n=t.prototype;return n.promise=function(){return this.l},n.states=function(){return this.v},t}(),y=function(){function t(){var t=this;this.l=new g(new Promise((function(n,r){t.m=n,t.g=r})))}var n=t.prototype;return n.promise=function(){return this.l.promise()},n.resolve=function(){return this.m(),this},n.reject=function(t){return this.g(t),this},n.states=function(){return this.l.states()},t}();function w(){return(new y).resolve()}function p(t,n,r){try{Object.defineProperty(t,n,r)}catch(t){var e=t&&t.message||"(no message)";(0,i._y)('Failed to set property "'+n+'": '+e)}}function S(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r=[];return t.forEach((function(t){t&&t.then?r.push(t):r.push(Promise.resolve(t))})),Promise.all(r)}},26203:function(t,n,r){"use strict";r.d(n,{d:function(){return Ft}});var i=r(59312),e=r(41293),u=function(){function t(n){n instanceof t?this.p(n.S):this.O(n)}var n=t.prototype;return Object.defineProperty(n,"Count",{get:function(){return this.S.fieldCount},enumerable:!1,configurable:!0}),n.has=function(t){return this.hasId(ut(t))},n.hasId=function(t){return!!this.S.map[t]},n.intersect=function(t){if(Array.isArray(t))return t.some(this.has.bind(this));var n=this,r=t;if(r.Count<n.Count){var i=n;n=r,r=i}for(var e in n.S.map)if(r.S.map[e])return!0;return!1},n.intersection=function(n){var r=this;if(Array.isArray(n))return new t(n.filter((function(t){return rt(t)&&r.has(t)})));if(n instanceof t){var i=this,e=n;if(e.Count<i.Count){var u=i;i=e,e=u}var o=new t;for(var c in i.S.map)e.hasId(c)&&o.addFieldSchema(st(c));return o}return new t},n.toArray=function(){return Object.keys(this.S.map).map(st)},n.clone=function(){return new t(this)},n.clear=function(){this.O()},n.addFieldSchema=function(t){this.has(t)||(this.j(),this.I(t))},n.addFieldSchemas=function(n){var r,i=this;(r=(r=n instanceof t?n.toArray():n).filter((function(t){return!i.has(t)}))).length&&(this.j(),this.I.bind(this),r.forEach((function(t){return i.I(t)})))},n.removeFieldSchema=function(t){this.has(t)&&(this.j(),this.F(t))},n.removeFieldSchemas=function(n){var r,i=this;(r=(r=n instanceof t?n.toArray():n).filter((function(t){return i.has(t)}))).length&&(this.j(),r.forEach((function(t){return i.F(t)})))},n.j=function(){1!==this.S.referenceCount&&this.O(this.toArray())},n.I=function(t){var n=ut(t);this.S.map[n]||(this.S.map[n]=!0,++this.S.fieldCount)},n.F=function(t){var n=ut(t);this.S.map[n]&&(delete this.S.map[n],--this.S.fieldCount)},n.O=function(t){this.p({map:{},fieldCount:0,referenceCount:0}),t&&this.addFieldSchemas(t)},n.p=function(t){this.S&&--this.S.referenceCount,this.S=t,++this.S.referenceCount},t}(),o=r(42874),c=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return(0,i.ZT)(n,t),n.prototype.toJSON=function(){return this.__nerve__.master.getSnapshot()},n}(o.k),s=r(36630);function f(t){if(t instanceof c)return t.__nerve__.master;(0,e._y)("Invalid parameter: please use '<your master>.Model.*' for the parameter.")}function h(t){return function(t){if(t instanceof a)return t.constructor;(0,e._y)("the parameter is not a nerve master object.")}(t).__nerve__.masterName}var a=function(t){function n(n){var r=t.call(this)||this,i=r.__nerve__,e=n&&n.Reserved&&n.Reserved.Membership;e&&(i.membership=(0,s.fm)(e),(0,s.z2)(i,"membership"));var u=!1;return(0,s._x)(i,"deleted",(function(){return u}),(function(t){if(!u&&t){u=!0,i.dirtyChecker.updateDirtiness();var n=i.changeManager;n.startBulkEditMode(),i.markChildrenAsDeleted(),n.markAsDeleted(),n.endBulkEditMode()}})),i.instanceId=(++v).toString(),(0,s.z2)(i,"instanceId"),r}(0,i.ZT)(n,t);var r=n.prototype;return Object.defineProperty(r,"Schema",{get:function(){return(0,e.ct)()},enumerable:!1,configurable:!0}),Object.defineProperty(r,"Model",{get:function(){return this.__nerve__.model},set:function(t){this.setData(t,this.Schema.__nerve__.subFields.toArray())},enumerable:!1,configurable:!0}),Object.defineProperty(r,"Parent",{get:function(){var t=this.__nerve__.membership;return t&&t.Parent},enumerable:!1,configurable:!0}),Object.defineProperty(r,"Membership",{get:function(){var t=this.__nerve__.membership;return{Parent:t&&t.Parent,FieldSchema:t&&t.FieldSchema}},enumerable:!1,configurable:!0}),Object.defineProperty(r,"Deleted",{get:function(){return this.__nerve__.deleted},set:function(t){this.__nerve__.deleted=t},enumerable:!1,configurable:!0}),r.getInstanceId=function(){return this.__nerve__.instanceId},r.getSnapshot=function(t){return this.__nerve__.changeManager.getSnapshot(t)},r.bulkEdit=function(t){var n=this.__nerve__.changeManager;n&&n.startBulkEditMode();try{return t(this.Model)}finally{n&&n.endBulkEditMode()}},r.observe=function(t,n){return this.__nerve__.changeManager.observe(t,n)},r.unobserve=function(t,n){return this.__nerve__.changeManager.unobserve(t,n)},r.addRule=function(t){return this.__nerve__.changeManager.addRule(t)},r.removeRule=function(t){return this.__nerve__.changeManager.removeRule(t)},n}(o.k),v=0,l=function(){function t(t){this.C=t,this.P=[],this.M=0,this.N=(0,s.Je)(),this.D=new s.uF(this.T.bind(this)),this.A=[],this.initializeSnapshot(),this.resetChangeInfo()}var n=t.prototype;return n.getSnapshot=function(t){if(!this.K){for(var n in this.R)this.refreshSubSnapshot(this.R[n]);this.R={},this.K=this.createSnapshotCache()}return this.K},n.definitelyMarkAsChanged=function(t){this.G=!0,this.markAsChanged(t)},n.markAsChanged=function(t,n){this.U();var r=t.FieldSchema,i=new u([r]);if(this._.addFieldSchema(r),n){this.J.push(n);var e=n.FieldSchemas.map(r.__nerve__.shadowMapper);i.addFieldSchemas(e)}this.markFieldsAsChanged(i)},n.markAsDeleted=function(){this.markFieldsAsChanged([this.C.Schema])},n.startBulkEditMode=function(){++this.M},n.endBulkEditMode=function(){--this.M<=0&&(this.M=0,this.D.flush())},n.observe=function(t,n){var r=this.P[this.B(t)];r?n?r.fieldSet.addFieldSchemas(n):r.fieldSet=this.V().clone():this.P.push({callback:t,fieldSet:new u(n||this.V())})},n.unobserve=function(t,n){var r=this.B(t),i=this.P[r];i&&(n?n.forEach((function(t){i.fieldSet.removeFieldSchemas(t.__nerve__.allContainedFields)})):i.fieldSet.clear(),0===i.fieldSet.Count&&this.P.splice(r,1))},n.addRule=function(t){this.A.indexOf(t)<0&&this.A.push(t)},n.removeRule=function(t){var n=this.A.indexOf(t);n>=0&&this.A.splice(n,1)},n.markSubSnapshotAsDirty=function(t){var n=this;if(t.length){this.K=void 0,t.forEach((function(t){return n.R[t.Name]=t}));var r=this.Master.__nerve__.membership,i=r&&r.Parent.__nerve__.changeManager;i&&i.markSubSnapshotAsDirty([r.Property])}},n.getChangingPeriod=function(){return this.N.promise()},Object.defineProperty(n,"Master",{get:function(){return this.C},enumerable:!1,configurable:!0}),n.createChange=function(t){var n=this.Master.__nerve__.deleted&&!this.W;return{BeingDeleted:n,DefinitelyMarked:this.G,FieldSchemas:Object.freeze(t.toArray()),Master:this.Master,NewValues:n?null:this.getSnapshot(),OldValues:this.Z,SubChanges:Object.freeze(this.J),UpdateNeeded:n}},n.resetChangeInfo=function(){this._=new u,this.J=[],this.Z=this.getSnapshot(),this.W=this.C.Deleted,this.G=!1},n.notifyChangeIfNeed=function(){this.M>0?this.D.callOnceLater():this.D.callImmediately()},n.anythingChanged=function(){return this._.Count>0||this.Master.__nerve__.deleted},n.markFieldsAsChanged=function(t,n){var r=this;this._.addFieldSchemas(t),this.q?this.H=!0:n?n.then((function(){return r.notifyChangeIfNeed()})):this.notifyChangeIfNeed()},n.shouldObserverBeNotified=function(t,n){return t.fieldSet.intersect(n.FieldSchemas)},n.removeUnchangedFields=function(t,n){},n.B=function(t){for(var n=0;n<this.P.length;++n)if(this.P[n].callback===t)return n},n.T=function(){var t=this;if(this.X(),this.Y(),this.G||this.Master.Deleted||this.removeUnchangedFields(this._,this.Z),this.anythingChanged()){var n=Object.freeze(this.createChange(this._));this.resetChangeInfo();var r=this.Master.__nerve__.membership;if(r&&r.Property.Mounted){var i=r.Parent.__nerve__.changeManager;i&&i.markAsChanged(r.Property,n)}this.P.concat().forEach((function(r){t.shouldObserverBeNotified(r,n)&&r.callback(n)}))}},n.X=function(){var t=this;this.q=!0;var n=0,r=this._,i=this.J,e=[],o=function(){var o=c.A.filter((function(n){return!n.InterestedFields||t._.intersect(n.InterestedFields)}));if(!o.length)return"break";if(++n>8*c.A.length)return c.$(e),"break";var s=c._,f=c.J;c._=new u,c.J=[];var h=c.Master.__nerve__.deleted&&!c.W;o.forEach((function(n){t.H=!1,n.onChange({Master:t.Master,BeingDeleted:h,FieldSchemas:s.toArray(),OldValues:t.Z,SubChanges:f}),t.H&&e.push(n)})),r.addFieldSchemas(c._),i.push.apply(i,c.J)},c=this;do{if("break"===o())break}while(this._.Count);this.q=!1,this._=r,this.J=i},n.$=function(t){(0,e.ZK)("following rules might do against each other: "+JSON.stringify(t.map((function(t){return t.Name})))+" (master: "+h(this.Master)+")")},n.V=function(){return this.Master.Schema.__nerve__.allContainedFields},n.U=function(){this.N.states()!==s.Cb.Pending&&(this.N=new s.wU)},n.Y=function(){this.N.resolve()},t}(),d=function(){function t(t){this.tt=t}return t.prototype.updateDirtiness=function(){if(this.tt){var t=this.getProperty();t.ParentMaster.__nerve__.dirtyChecker.setMemberDirtiness(t.Name,this.isDirty())}},t}(),b=function(t){function n(n,r){var i=t.call(this,r)||this;return i.nt=n,i}(0,i.ZT)(n,t);var r=n.prototype;return r.isDirty=function(){return this.rt!==this.convertModelToSourceData()},r.initializeSourceData=function(t){this.setSourceData(t)},r.getDelta=function(){return this.convertModelToSourceData()},r.getSnapshotToUpdate=function(){return this.convertModelToSourceData()},r.getSourceData=function(){return this.rt},r.setSourceData=function(t){void 0===t&&(t=null),this.rt=t,this.updateDirtiness()},r.onSourceDataReceived=function(t){var n=this.isDirty();this.setSourceData(t),n||this.nt.setter(this.convertFromSourceData(t))},r.getProperty=function(){return this.nt},r.convertModelToSourceData=function(){return this.nt.getter()},r.convertFromSourceData=function(t){return t},n}(d),m=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}(0,i.ZT)(n,t);var r=n.prototype;return r.convertModelToSourceData=function(){return this.it(this.getProperty().getter())},r.convertFromSourceData=function(t){return this.it(t)},r.it=function(t){return null==t?null:this.getProperty().FieldSchema.__nerve__.enumType[t]},n}(b),g=function(){function t(t,n,r){var i=this;this.et=t,this.ut=n;var e=r.Reserved.Membership;this.ot=e.Parent,e.Property=this,this.st=!1,r.Reserved.Mounted.then((function(){return i.st=!0}))}var n=t.prototype;return Object.defineProperty(n,"Name",{get:function(){return this.et},enumerable:!1,configurable:!0}),Object.defineProperty(n,"FieldSchema",{get:function(){return this.ut},enumerable:!1,configurable:!0}),Object.defineProperty(n,"ParentMaster",{get:function(){return this.ot},enumerable:!1,configurable:!0}),Object.defineProperty(n,"Index",{get:function(){return this.ft},set:function(t){if(t!==this.ft){var n=this.ft;this.ft=t;var r=this.ParentMaster;this.indexDirtinessUpdateNeeded()&&r.__nerve__.dirtyChecker.updateDirtinessForIndexChange(this),this.Mounted&&r.__nerve__.changeManager.onPropertyIndexChange(this,n)}},enumerable:!1,configurable:!0}),Object.defineProperty(n,"Mounted",{get:function(){return this.st},enumerable:!1,configurable:!0}),Object.defineProperty(n,"Deleted",{get:function(){return this.ht},enumerable:!1,configurable:!0}),Object.defineProperty(n,"ParentDirtyChecker",{get:function(){return this.ParentMaster.__nerve__.dirtyChecker},enumerable:!1,configurable:!0}),n.markAsDeleted=function(t){this.ht=!0,this.Index=void 0},n.getKey=function(){return this.ut.__nerve__.getKey(this.getter())},t}(),y=function(t){function n(n,r,i){var e=t.call(this,n,r,i)||this;e.at=e.normalizeValue(i.InitialData);var u=!r.__nerve__.info.Attributes.IsLocalField;return e.vt=e.createDirtyChecker(u),e}(0,i.ZT)(n,t);var r=n.prototype;return r.getter=function(){return this.at},r.setter=function(t){if(t=this.normalizeValue(t),this.at!==t){this.at=t,this.vt.updateDirtiness();var n=this.ParentMaster.__nerve__.changeManager;n.markSubSnapshotAsDirty([this]),n.markAsChanged(this)}},r.getDirtyChecker=function(){return this.vt},r.normalizeValue=function(t){return null==t?null:t},r.createDirtyChecker=function(t){return new b(this,t)},r.indexDirtinessUpdateNeeded=function(){return!0},n}(g),w=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}(0,i.ZT)(n,t);var r=n.prototype;return r.normalizeValue=function(t){var n=typeof t;if("string"===n||"number"===n){var r=this.FieldSchema.__nerve__.enumType;if(t in r)return"string"===n?r[t]:t}return null},r.createDirtyChecker=function(t){return new m(this,t)},n}(y),p=r(39923);function S(t){return t.__nerve__.info.IsLeaf}function O(t,n,r,i,e){var u=lt({enumTypeGetter:r.__nerve__.enumTypeGetter,getKeyForReferenceType:r.__nerve__.keyGetter,info:{Attributes:(0,p.u9)(r),FieldId:t,IsLeaf:!0,IsCollection:!1,Name:i,Path:e||i},parentMasterClass:n,parentSchema:n.__nerve__.schema,withDataSource:!1});return u.__nerve__.generateProperty=function(t){return t.__nerve__.asEnum?function(n,r){return new w(n,t,r)}:function(n,r){return new y(n,t,r)}}(u),(0,s.z2)(u.__nerve__,"generateProperty"),u}var j=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}(0,i.ZT)(n,t);var r=n.prototype;return r.markAsChanged=function(n,r){r&&r.BeingDeleted?this.Master.deleteItems([n.getter()]):t.prototype.markAsChanged.call(this,n,r)},r.onPropertiesAdded=function(t,n){t.length&&(this.lt=this.lt.concat(t),this.dt=void 0,this.markSubSnapshotAsDirty(t),this.markFieldsAsChanged(this.Master.Schema.__nerve__.allContainedFields,n))},r.onPropertiesRemoved=function(t,n){var r=this;t.length&&(t.forEach((function(t){var n=r.lt.indexOf(t);n>=0?r.lt.splice(n,1):r.bt.push(t),r.gt[t.Name]&&(delete r.gt[t.Name],--r.yt)})),this.dt=void 0,this.markSubSnapshotAsDirty(t),this.markFieldsAsChanged(this.Master.Schema.__nerve__.allContainedFields,n))},r.onPropertyIndexChange=function(t,n){this.markSubSnapshotAsDirty([t]),this.gt[t.Name]?this.gt[t.Name].NewIndex=t.Index:(this.gt[t.Name]={OldIndex:n,NewIndex:t.Index},++this.yt),this.notifyChangeIfNeed()},r.initializeSnapshot=function(){S(this.Master.Schema[0])?this.wt=n.getSubSnapshotForLeafContent:this.wt=n.getSubSnapshotForMasterContent,this.St()},r.refreshSubSnapshot=function(t){this.dt&&!t.Deleted&&(this.dt[t.Index]=this.wt(t.getter()))},r.createSnapshotCache=function(){return this.dt||this.St(),this.dt.concat()},r.createChange=function(n){var r=this,i=t.prototype.createChange.call(this,n),e=function(t){return t.getter()},u=function(t){return r.wt(t)};i.AddedModels=Object.freeze(this.lt.map(e)),i.AddedItemsAsSnapshots=Object.freeze(i.AddedModels.map(u)),i.RemovedModels=Object.freeze(this.bt.map(e)),i.RemovedItemsAsSnapshots=Object.freeze(i.RemovedModels.map(u));var o={};Object.keys(this.gt).forEach((function(t){var n=r.gt[t];null!=n.NewIndex&&null!=n.OldIndex&&(o[n.NewIndex]=n.OldIndex)})),i.ChangedIndexMap=Object.freeze(o);var c=this.Master.Schema[0];return i.UpdateNeeded||c.__nerve__.info.Attributes.IsLocalField||(i.UpdateNeeded=i.AddedModels.length>0||i.RemovedModels.length>0||i.SubChanges.some((function(t){return t.UpdateNeeded}))),i},r.resetChangeInfo=function(){t.prototype.resetChangeInfo.call(this),this.lt=[],this.bt=[],this.gt={},this.yt=0},r.anythingChanged=function(){return this.lt.length>0||this.bt.length>0||this.yt>0||t.prototype.anythingChanged.call(this)},r.shouldObserverBeNotified=function(n,r){return!!Object.keys(r.ChangedIndexMap).length||t.prototype.shouldObserverBeNotified.call(this,n,r)},r.St=function(){this.dt=[];for(var t=this.Master.Model,n=0;n<t.length;++n)this.dt[n]=this.wt(t[n])},n.getSubSnapshotForLeafContent=function(t){return t},n.getSubSnapshotForMasterContent=function(t){return f(t).getSnapshot()},n}(l),I=function(t){function n(n,r,i){var e=t.call(this,i)||this;return e.Ot={},e.jt=0,e.C=n,e.It=r,e}(0,i.ZT)(n,t);var r=n.prototype;return Object.defineProperty(r,"Master",{get:function(){return this.C},enumerable:!1,configurable:!0}),Object.defineProperty(r,"ExistingInSource",{get:function(){return this.It},set:function(t){this.It=t,this.updateDirtiness()},enumerable:!1,configurable:!0}),r.isDirty=function(){if(this.C.__nerve__.deleted){var t=this.Master.Parent;return!(t&&t.__nerve__.deleted)&&this.It}return 0!==this.jt},r.setMemberDirtiness=function(t,n){!this.Ot[t]!=!n&&(n?(this.Ot[t]=!0,0==this.jt++&&this.updateDirtiness()):(delete this.Ot[t],0==--this.jt&&this.updateDirtiness()))},r.getDirtyKeys=function(){return Object.keys(this.Ot)},r.getProperty=function(){return this.C.__nerve__.membership.Property},n}(d),F=function(t){function n(n,r,i){var e=t.call(this,n,r,i)||this;return e.Ft([]),e}(0,i.ZT)(n,t);var r=n.prototype;return r.initializeSourceData=function(t){var n=this;this.Ft(t||[]),this.Ct().forEach((function(t){var r=t.getDirtyChecker(),i=n.rt[n.Pt(t)];r.initializeSourceData(i)})),this.updateDirtinessForLength(this.Master.Model.length)},r.getDelta=function(){return(0,e.ys)("get delta for collection is not supported yet.")},r.getSnapshotToUpdate=function(){return this.Ct().map((function(t){return t.getDirtyChecker()})).map((function(t){return t.getSnapshotToUpdate()}))},r.getSourceData=function(){return at(this.rt,this.Master.Schema)},r.setSourceData=function(t){this.setSourceDataInternal(t||[])},r.onSourceDataReceived=function(t){t=t||[],this.Ft(t),this.Master.Model.__nerve__.onSourceDataReceived(t),this.updateDirtinessForLength(this.Master.Model.length)},r.updateDirtinessForLength=function(t){this.setMemberDirtiness("length",t!==this.getSourceDataLength())},r.updateDirtinessForIndexChange=function(t){t.Deleted?this.setMemberDirtiness(t.Name,!1):t.getDirtyChecker().setSourceData(this.rt[t.Index])},r.getSourceDataLength=function(){return this.rt.length},r.setSourceDataInternal=function(t){var n=this;this.Ft(t),this.Ct().forEach((function(t){var r=t.getDirtyChecker(),i=n.Pt(t);r.setSourceData(n.rt[i]),r instanceof I&&(r.ExistingInSource=i<n.rt.length)})),this.updateDirtinessForLength(this.Master.Model.length)},r.Ct=function(){return this.Master.Model.__nerve__.properties},r.Ft=function(t){var n=this;this.rt=t;var r=this.Master.Schema[0];r.__nerve__.withKey&&(this.Mt={},t.map(r.__nerve__.getKeyFromSourceData).forEach((function(t,r){t&&(n.Mt[t]=r)})))},r.Pt=function(t){return this.Master.Schema[0].__nerve__.withKey?this.Mt[t.getKey()]:t.Index},n}(I),C=function(t){function n(n,r){var i,e,u=this,o=n.Schema[0];o.__nerve__.withKey?(i=k,e=R):(i=o.__nerve__.info.IsLeaf?A:K,e=x);var c=r.Reserved&&r.Reserved.ParentExistingInDataSource;return(u=t.call(this,{master:n,keyToProperty:o.__nerve__.withKey?{}:null,initializedLength:0,newestPropertyName:0,masterTreeReady:r.MasterTreeReady,properties:[],addItems:function(t,n){return P(u,t,n,c)},deleteItems:function(t,n){return function(t,n,r){var i=t.__nerve__.properties.filter((function(t){var r=t.getter();return n.some((function(t){return t===r}))}));return D(t,i,r),i}(u,t,n)},setData:function(t){return i(u,t)},onSourceDataReceived:function(t){return e(u,t)},setComparer:function(t){u.__nerve__.comparer=t,u.__nerve__.propertyComparer=t&&function(n,r){return t(n.getter(),r.getter())},t&&E(u,u.__nerve__.propertyComparer)}})||this).ensureFieldsReadyPromiseChain=Promise.resolve([]),P(u,(0,s.L)(r.InitialData),r.ExistingInDataSource,c),u}(0,i.ZT)(n,t);var r=n.prototype;return Object.defineProperty(r,"length",{get:function(){return this.__nerve__.properties.length},enumerable:!1,configurable:!0}),n}(c);function P(t,n,r,i){var e=t.__nerve__.master,u=e.Schema[0],o=u.__nerve__.generateProperty,c=new s.wU,f=(0,s.GP)(t.__nerve__.masterTreeReady,c.promise()),h=n.map((function(n){return o((++t.__nerve__.newestPropertyName).toString(),{InitialData:n,ExistingInDataSource:r,MasterTreeReady:f,Reserved:{Membership:{Parent:e,FieldSchema:u},ParentExistingInDataSource:i,Mounted:c.promise()}})})),a=[t.ensureFieldsReadyPromiseChain];if(u.__nerve__.withKey){var v=t.__nerve__.keyToProperty;if(u.__nerve__.withDataSource){var l=u.__nerve__.keyFields.toArray();h.forEach((function(t){var n=t.Master;a.push(n.Synchronizer.ensureFieldsReady(l).then((function(){return M(v,t,!0)})))}))}h.forEach((function(t){return M(v,t)}))}var d=t.__nerve__.properties,b=d.length;return e.bulkEdit((function(){d.push.apply(d,h),function(t){var n=t.__nerve__,r=n.properties.length;for(;n.initializedLength<r;)N(t,n.initializedLength),++n.initializedLength}(t);for(var n=b;n<d.length;++n)d[n].Index=n;e.__nerve__.dirtyChecker.updateDirtinessForLength(d.length);var r=t.__nerve__.propertyComparer;r&&E(t,r),c.resolve();var i=e.__nerve__.changeManager,u=Promise.all(a);t.ensureFieldsReadyPromiseChain=u,i&&i.onPropertiesAdded(h,u)})),h}function M(t,n,r){void 0===r&&(r=!1);var i=n.getKey();if(i){if(i in t){if(r)return;(0,e._y)('duplicated key "'+i+'" at '+ct(n.FieldSchema)+" is being added.")}t[i]=n}}function N(t,n){(0,s._x)(t,n,(function(){return n>=this.__nerve__.properties.length&&(0,e._y)("Get item out of range. Index: "+n+"; Length: "+this.__nerve__.properties.length),this.__nerve__.properties[n].getter()}),(function(t){n>=this.__nerve__.properties.length&&(0,e._y)("Set item out of range. Index: "+n+"; Length: "+this.__nerve__.properties.length),this.__nerve__.properties[n].setter(t)}))}function D(t,n,r){var i=n.length;if(i>0){var e=t.__nerve__.properties,u=e.length,o=t.__nerve__.master;o.bulkEdit((function(){for(;i>0;--i){for(var c=n[i-1];--u>c.Index;)e[u].Index-=i;e.splice(u,1),c.markAsDeleted(r)}var s=o.Schema[0],f=[t.ensureFieldsReadyPromiseChain];if(s.__nerve__.withKey){var h=t.__nerve__.keyToProperty;if(s.__nerve__.withDataSource){var a=s.__nerve__.keyFields.toArray();n.forEach((function(t){var n=t.Master;f.push(n.Synchronizer.ensureFieldsReady(a).then((function(){return T(h,t)})))}))}n.forEach((function(t){return T(h,t)}))}var v=Promise.all(f);t.ensureFieldsReadyPromiseChain=v,o.__nerve__.dirtyChecker.updateDirtinessForLength(e.length),o.__nerve__.changeManager.onPropertiesRemoved(n,v)}))}}function T(t,n){var r=n.getKey();r&&r in t&&n===t[r]&&delete t[r]}function E(t,n){n&&t.__nerve__.properties.sort(n),t.__nerve__.master.bulkEdit((function(){t.__nerve__.properties.forEach((function(t,n){t.Index=n}))}))}function k(t,n){var r=t.__nerve__.master,i=t.__nerve__.master.Schema[0],e=t.__nerve__.properties,u={};n.map(i.__nerve__.getKey).forEach((function(t,n){return u[t]=n}));var o={};e.forEach((function(t){return o[t.getKey()]=t}));var c={};r.bulkEdit((function(){var r=[];for(var i in u){var e=u[i];if(i in o){var s=o[i];s.setter(n[e]),c[s.Name]=e,delete o[i]}else r.push(e)}var f=[];for(var i in o)f.push(o[i]);f.length&&(f.sort((function(t,n){return t.Index-n.Index})),D(t,f,!1)),r.length&&t.__nerve__.addItems(r.map((function(t){return n[t]})),!1).forEach((function(t,n){return c[t.Name]=r[n]}));var h=function(t,n){return c[t.Name]-c[n.Name]},a=t.__nerve__.propertyComparer;E(t,a?function(t,n){return a(t,n)||h(t,n)}:h)}))}function A(t,n){for(var r=t.__nerve__.master,i={},u=(0,s.L)(t.__nerve__.master.getSnapshot()).slice(),o=[],c={},f=0;f<n.length;++f){var h=n[f],a=u.indexOf(h);a<0?o.push(h):(c[f]=a,u[a]=i)}var v=t.__nerve__.properties,l=[];for(f=0;f<u.length;++f)u[f]!==i&&l.push(v[f]);var d=v.slice();r.bulkEdit((function(){var r=t.__nerve__.addItems(o,!1);l.length&&(l.sort((function(t,n){return t.Index-n.Index})),D(t,l,!1)),(0,e.hu)(n.length===v.length,"All items should be updated into properties.");for(var i=0,u=0;u<n.length;++u)null==c[u]?v[u]=r[i++]:v[u]=d[c[u]];E(t,t.__nerve__.propertyComparer)}))}function K(t,n){t.__nerve__.master.bulkEdit((function(){var r=t.length,i=Math.min(r,n.length),e=t.__nerve__.properties;n=n.map((function(t,n){return t instanceof c?n<r&&e[n].getter()===t?t:f(t).getSnapshot():t}));for(var u=0;u<i;++u)e[u].setter(n[u]);if(r<n.length)t.__nerve__.addItems(n.slice(t.length),!1);else if(r>n.length){var o=t.__nerve__.properties.slice(n.length);D(t,o,!1)}}))}function R(t,n){var r=t.__nerve__.master;r.bulkEdit((function(){var i,e=r.Schema[0].__nerve__,u=t.__nerve__.keyToProperty,o={},c=[];n.map(e.getKeyFromSourceData).forEach((function(t,r){o[t]=r,t in u?u[t].getDirtyChecker().onSourceDataReceived(n[r]):c.push(n[r])})),i=e.withDataSource?function(t){return t.Master.Synchronizer.existingInDataSourcePromiseState()===s.Cb.Resolved&&!(t.getKey()in o)}:function(t){return!(t.getKey()in o)};var f=t.__nerve__.properties.filter(i);D(t,f,!0);var h=ft(c,r.Schema);t.__nerve__.addItems(h,!0);var a=t.__nerve__.propertyComparer;a||(a=function(t,n){return o[t.getKey()]-o[n.getKey()]}),E(t,a)}))}function x(t,n){var r=t.__nerve__.master;r.bulkEdit((function(){for(var i=t.length,e=Math.min(i,n.length),u=t.__nerve__.properties,o=0;o<e;++o)u[o].getDirtyChecker().onSourceDataReceived(n[o]);if(i<n.length){var c=ft(n.slice(i),r.Schema);t.__nerve__.addItems(c,!0)}else if(i>n.length){var s=t.__nerve__.properties.slice(n.length);D(t,s,!0)}}))}var G="collection master";var U=function(t){function n(n){var r;n=n||{};var i=r=t.call(this,n)||this,e=r.__nerve__;e.markChildrenAsDeleted=function(){var t;S((t=i).Schema[0])||(0,s.L)(t.Model).map(f).forEach((function(t){return t.Deleted=!0}))},(0,s.z2)(e,"markChildrenAsDeleted");var u=r.Schema.__nerve__,o=!u.withDataSource&&!u.info.Attributes.IsLocalField;return e.dirtyChecker=new F(i,n.ExistingInDataSource,o),(0,s.z2)(e,"dirtyChecker"),e.model=new C(i,n),(0,s.z2)(e,"model"),e.changeManager=new j(i),(0,s.z2)(e,"changeManager"),r}(0,i.ZT)(n,t);var r=n.prototype;return r.addItems=function(t){return this.Model.__nerve__.addItems(t,!1).map((function(t){return t.getter()}))},r.deleteItems=function(t){return this.Model.__nerve__.deleteItems(t,!1).map((function(t){return t.getter()}))},r.itemsAddedInSource=function(t){return this.Model.__nerve__.addItems(t,!0).map((function(t){return t.getter()}))},r.itemsDeletedInSource=function(t){return this.Model.__nerve__.deleteItems(t,!0).map((function(t){return t.getter()}))},r.getItemWithKeyFields=function(t){var n=this.Schema[0].__nerve__.getKey(t),r=this.Model.__nerve__.keyToProperty[n];return r&&r.getter()},r.getIndexWithKeyFields=function(t){var n=this.Schema[0].__nerve__.getKey(t),r=this.Model.__nerve__.keyToProperty[n];return r?r.Index:-1},r.markAsChanged=function(t){var n=this.Model.__nerve__.properties[t];n&&this.__nerve__.changeManager.definitelyMarkAsChanged(n)},r.setComparer=function(t){this.Model.__nerve__.setComparer(t)},r.setData=function(t){this.Model.__nerve__.setData((0,s.L)(t))},n}(a);var L=function(t){function n(n,r,i){var e=t.call(this,n,r,i)||this,u=r.__nerve__.subMasterClassGetter();return e.C=new u(i),e}(0,i.ZT)(n,t);var r=n.prototype;return Object.defineProperty(r,"Master",{get:function(){return this.C},enumerable:!1,configurable:!0}),r.getter=function(){return this.C.Model},r.setter=function(t){this.C.setData(t,this.C.Schema.__nerve__.subFields.toArray())},r.markAsDeleted=function(n){t.prototype.markAsDeleted.call(this,n),n&&(this.getDirtyChecker().ExistingInSource=!1),this.C.Deleted=!0},r.getDirtyChecker=function(){return this.C.__nerve__.dirtyChecker},r.indexDirtinessUpdateNeeded=function(){return!this.FieldSchema.__nerve__.withDataSource},n}(g);function z(t){return t.__nerve__.info.IsCollection}function Q(t,n,r,i,u,o){var c=r.Schema,f=c.__nerve__,h=lt({enumTypeGetter:f.enumTypeGetter,getKeyForReferenceType:f.getKeyForReferenceType,info:{Attributes:o,FieldId:t,IsCollection:f.info.IsCollection,IsLeaf:f.info.IsLeaf,Name:i,Path:u||i},parentMasterClass:n,parentSchema:n.__nerve__.schema,shadowParent:c,shadowRoot:c,subMasterClassGetter:function(){return r},withDataSource:f.withDataSource}),a={};return a[ut(r.__nerve__.schema)]=h,h.__nerve__.generateProperty=function(t){return function(n,r){return new L(n,t,r)}}(h),(0,s.z2)(h.__nerve__,"generateProperty"),h.__nerve__.shadowMapper=function(t,n){return function r(i){var u=ut(i),o=n[u];if(!o){var c=i.__nerve__.parentSchema;o=(rt(c)?r(c):t)[ot(i)],(0,e.hu)(o===n[u],"the new shadow should be added into the shadow map.")}return o}}(h,a),(0,s.z2)(h.__nerve__,"shadowMapper"),_(h,r.Schema,a),h}function _(t,n,r){Object.keys(n).forEach((function(i){(0,s.EA)(t,i,function(t,n,r,i){return function(){var e=n[r],u=e.__nerve__,o=lt({enumTypeGetter:u.enumTypeGetter,getKeyForReferenceType:u.getKeyForReferenceType,info:{Attributes:u.info.Attributes,FieldId:bt(),IsCollection:u.info.IsCollection,IsLeaf:u.info.IsLeaf,Name:r,Path:dt(t.__nerve__.info.Path,r)},parentSchema:t,parentMasterClass:t.__nerve__.parentMasterClass,shadowParent:e,shadowRoot:u.shadowRoot,subMasterClassGetter:u.subMasterClassGetter,withDataSource:u.withDataSource});return i[ut(e)]=o,_(o,e,i),o}}(t,n,i,r))}))}var J={ObjectSynchronizer:void 0},B=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}(0,i.ZT)(n,t);var r=n.prototype;return r.getSnapshot=function(n){var r=t.prototype.getSnapshot.call(this,n);if(!n)return r;var i={};return this.Master.Schema.__nerve__.subFields.intersection(n).toArray().map(ot).forEach((function(t){return i[t]=r[t]})),i},r.initializeSnapshot=function(){var t=this;this.dt={};var n=this.Master,r=n.Schema.__nerve__.subFields.toArray();if(q(n)){var i=n;r=r.filter((function(t){return i.isFieldReady(t)}))}r.forEach((function(n){return t.Nt(n)}))},r.refreshSubSnapshot=function(t){this.Nt(t.FieldSchema)},r.createSnapshotCache=function(){return Object.freeze((0,s.kI)(this.dt))},r.createChange=function(n){var r=t.prototype.createChange.call(this,n);return r.UpdateNeeded||(r.UpdateNeeded=n.toArray().some((function(t){return t.__nerve__.info.IsLeaf&&!t.__nerve__.info.Attributes.IsLocalField}))),r.UpdateNeeded||(r.UpdateNeeded=r.SubChanges.filter((function(t){return t.UpdateNeeded})).some((function(t){var r=t.Master.Membership.FieldSchema;return n.has(r)&&!r.__nerve__.info.Attributes.IsLocalField}))),r},r.removeUnchangedFields=function(t,n){var r=this,i=this.Master.Schema,e=t.toArray().filter((function(t){if(t.__nerve__.parentSchema===i&&S(t)){var e=ot(t);return r.Master.Model[e]===n[e]}return!1}));t.removeFieldSchemas(e)},r.Nt=function(t){var n=ot(t),r=this.Master.Model[n];if(S(t))this.dt[n]=r;else{var i=f(r);this.dt[n]=i.getSnapshot()}},n}(l),V=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}(0,i.ZT)(n,t);var r=n.prototype;return r.initializeSourceData=function(t){t=this.Dt(t);var n=this.Master.Schema,r=this.Master.Model.__nerve__.properties;for(var i in r){var e=n[i].__nerve__.sourceName;r[i].getDirtyChecker().initializeSourceData(t[e])}},r.getDelta=function(){var t=this;if(this.isDirty()){var n=this.Master.Schema,r={};return this.getDirtyKeys().sort().forEach((function(i){var e=n[i].__nerve__.sourceName;r[e]=t.Tt(i).getSnapshotToUpdate()})),r}},r.getSnapshotToUpdate=function(){var t={},n=this.Master.Schema,r=this.Et();for(var i in r){t[n[i].__nerve__.sourceName]=r[i].getSnapshotToUpdate()}return t},r.getSourceData=function(){var t={},n=this.Master.Schema,r=this.Et();for(var i in r){t[n[i].__nerve__.sourceName]=r[i].getSourceData()}return t},r.setSourceData=function(t){var n=this;t=this.Dt(t),Object.keys(t).forEach((function(r){n.At(r).setSourceData(t[r])}))},r.onSourceDataReceived=function(t){var n,r=this;t=this.Dt(t);var i=this.Master;if(q(i)){n=new s.wU;var e=this.Master.Schema.__nerve__.sourceNameToClientName,u=Object.keys(t).map((function(t){return e[t]})).filter((function(t){return t}));i.Synchronizer.markFieldsAsReady(u,n.promise())}i.bulkEdit((function(){Object.keys(t).forEach((function(n){r.At(n).onSourceDataReceived(t[n])}))})),n&&n.resolve()},r.Dt=function(t){var n=this.Master.Schema.__nerve__.sourceNameToClientName,r={};return t?Object.keys(t).filter((function(t){return t in n})).forEach((function(n){return r[n]=t[n]})):Object.keys(n).forEach((function(t){return r[t]=null})),r},r.Et=function(){var t=this.Master.Model.__nerve__.properties,n={};return this.Master.Schema.__nerve__.subFields.toArray().filter((function(t){return!t.__nerve__.info.Attributes.IsLocalField})).map(ot).forEach((function(r){return n[r]=t[r].getDirtyChecker()})),n},r.Tt=function(t){return this.Master.Model.__nerve__.properties[t].getDirtyChecker()},r.At=function(t){var n=this.Master.Schema.__nerve__.sourceNameToClientName[t];return this.Tt(n)},n}(I),W=function(t){function n(n,r,i,u,o,c){var f,h={};f=t.call(this,{master:n,properties:h})||this;var a=function(t){return q(t)?function(n,r){var i=function(){if(!t.isFieldReady(r)){var n=ct(r);(0,e._y)("The field ("+n+") not ready yet.")}};return{getter:function(){return i(),n.getter()},setter:function(t){i(),n.setter(t)}}}:function(t,n){return{getter:function(){return t.getter()},setter:function(n){return t.setter(n)}}}}(n);return Object.keys(n.Schema).forEach((function(t){var e=n.Schema[t],v=e.__nerve__.generateProperty(t,{InitialData:r[t],ExistingInDataSource:i,MasterTreeReady:o,Reserved:{Membership:{FieldSchema:e,Parent:n},ParentExistingInDataSource:c,Mounted:u}});h[t]=v;var l=a(v,e);(0,s._x)(f,t,l.getter,l.setter)})),f}return(0,i.ZT)(n,t),n}(c);var Z="object master";function q(t){return t instanceof Y}function H(t,n,r){(0,p.bn)(t,n);var e=function(t){function n(n,i){return t.call(this,n,i,r)||this}(0,i.ZT)(n,t);var e=n.prototype;return Object.defineProperty(n,"Schema",{get:function(){return n.__nerve__.schema},enumerable:!1,configurable:!0}),Object.defineProperty(e,"Schema",{get:function(){return n.__nerve__.schema},enumerable:!1,configurable:!0}),n}(r?Y:X);return(0,o.s)(e,(0,s.fm)({nerveObjectType:Z,masterName:t,dataSourceFactory:r}),!0),e.__nerve__.schema=vt(e,n),(0,s.z2)(e.__nerve__,"schema"),e}var X=function(t){function n(n,r,i){var e;n=n||{},r=r||{};var u=(e=t.call(this,n)||this).__nerve__;u.markChildrenAsDeleted=function(){var t;(t=e).Schema.__nerve__.subFields.toArray().filter((function(t){return!S(t)})).map(ot).map((function(n){return t.Model.__nerve__.properties[n]})).map((function(t){return t.Master})).forEach((function(t){return t.Deleted=!0}))},(0,s.z2)(u,"markChildrenAsDeleted");var o,c=new s.wU,f=(0,s.GP)(r.MasterReady,c.promise()),h=!i&&u.membership&&!u.membership.FieldSchema.__nerve__.info.Attributes.IsLocalField;if(u.dirtyChecker=new V(e,n.ExistingInDataSource,h),(0,s.z2)(u,"dirtyChecker"),i?(u.synchronizer=new J.ObjectSynchronizer(e,n,r,f,i),o=u.synchronizer.existingInDataSource()):(u.synchronizer=null,o=n.Reserved&&n.Reserved.ParentExistingInDataSource),(0,s.z2)(u,"synchronizer"),u.model=new W(e,n.InitialData||{},n.ExistingInDataSource,f,(0,s.GP)(n.MasterTreeReady,f).then((function(){})),o),(0,s.z2)(u,"model"),u.changeManager=new B(e),(0,s.z2)(u,"changeManager"),i){var a=ht(n.ExistingInDataSource?n.InitialData:null,e.Schema);u.dirtyChecker.initializeSourceData(a)}return c.resolve(),e}(0,i.ZT)(n,t);var r=n.prototype;return r.setData=function(t,n){var r=this.Model;if(t!==r){var i;if(t=t||{},n)i=$(this,n);else{var u=this.Schema;i=Object.keys(t).map((function(t){return u[t]})).filter((function(t){return t}))}var o=[];this.bulkEdit((function(){i.map(ot).forEach((function(n){n in r?r[n]=t[n]:o.push(n)}))})),o.length&&(0,e.ZK)("following field(s) not found in "+h(this)+": "+o)}},r.getModelByFieldSchema=function(t){var n=t;it(n),n=tt(this,n);for(var r=this.Schema,i=[];n!==r;){if(i.push(n),n.__nerve__.info.IsCollection)throw Error("unable to get model/value from collection "+ct(n)+".");n=n.__nerve__.parentSchema}var e=this.Model;do{e=e[ot(n=i.pop())]}while(i.length);return e},n}(a),Y=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}(0,i.ZT)(n,t);var r=n.prototype;return Object.defineProperty(r,"Synchronizer",{get:function(){return this.__nerve__.synchronizer},enumerable:!1,configurable:!0}),r.isFieldReady=function(t){return this.Synchronizer.isFieldReady(t)},r.ensureFieldsReady=function(t){return this.Synchronizer.ensureFieldsReady(t)},r.fieldsReady=function(t){return this.Synchronizer.fieldsReady(t)},r.getRelatedSourceFields=function(t){return t},r.forceFieldsReady=function(t){return this.Synchronizer.forceFieldsReady(t)},n}(X);function $(t,n){return n.map((function(n){var r=t.Schema;if("string"==typeof n){var i=r[n];if(rt(i))return i}else if(rt(n))return tt(t,n);(0,e._y)("field "+n+" doesn't exist in master "+h(t))}))}function tt(t,n){for(var r=t.Schema,i=[];n.__nerve__.shadowRoot!==r;){var u=ot(n);i.push(u),(n=n.__nerve__.parentSchema)||(0,e._y)("field schema ("+ct(n)+") is not a member schema of master ("+h(t)+")")}for(var o=r;i.length;){o=o[u=i.pop()]}return o}var nt="FieldSchema";function rt(t){var n=t&&t.__nerve__;return n&&n.nerveObjectType===nt}function it(t){if(!rt(t))throw Error("Invalid parameter: please use '<your master [class]>.Schema.*' for the parameter.");return!0}function et(t){return it(t),t.__nerve__.info}function ut(t){return et(t).FieldId}function ot(t){return et(t).Name}function ct(t){return et(t).Path}function st(t){return gt[t]}function ft(t,n){if(S(n)){if(n.__nerve__.asEnum){var r=n.__nerve__.enumType;if(r&&"string"==typeof t&&t in r)return r[t]}return t}if(z(n))return(0,s.L)(t).map((function(t){return ft(t,n[0])}));if(t){var i={},e=n.__nerve__.sourceNameToClientName;return Object.keys(t).forEach((function(r){if(r in e){var u=e[r],o=n[u];i[u]=ft(t[r],o)}})),i}return null}function ht(t,n){if(S(n)){if(n.__nerve__.asEnum){var r=n.__nerve__.enumType;if(r&&"number"==typeof t&&t in r)return r[t]}return t}if(z(n))return(0,s.L)(t).map((function(t){return ht(t,n[0])}));if(t){var i={};return Object.keys(n).forEach((function(r){if(r in t){var e=n[r];if(!e.__nerve__.info.Attributes.IsLocalField){var u=e.__nerve__.sourceName;i[u]=ht(t[r],e)}}})),i}return null}function at(t,n){if(S(n))return t;if(z(n))return(0,s.L)(t).map((function(t){return at(t,n[0])}));if(t){var r={},i=n.__nerve__.sourceNameToClientName;return Object.keys(t).forEach((function(e){if(e in i){var u=n[i[e]];r[e]=at(t[e],u)}})),r}return null}function vt(t,n){var r=t.__nerve__.masterName,e={enumTypeGetter:null,getKeyForReferenceType:null,info:{Attributes:(0,p.u9)(n),FieldId:bt(),IsCollection:!(!(0,p.f4)(n)||!n.__nerve__.isCollection),IsLeaf:!1,Name:r,Path:r},parentMasterClass:t,shadowParent:null,withDataSource:!!t.__nerve__.dataSourceFactory};e.info.IsCollection&&(0,s.EA)(e,"withDataSource",(function(){return u[0].__nerve__.withDataSource}));var u=lt(e);return Object.keys(n).forEach((function(r){(0,s.EA)(u,r,function(t,n,r){var e=bt();return function(){var u,c=dt(t.__nerve__.masterName,n);if((0,p.f4)(r)){if(r.__nerve__.isLeaf)return O(e,t,r,n,c);r.__nerve__.isCollection?u=function(t,n){var r=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}(0,i.ZT)(n,t);var r=n.prototype;return Object.defineProperty(n,"Schema",{get:function(){return n.__nerve__.schema},enumerable:!1,configurable:!0}),Object.defineProperty(r,"Schema",{get:function(){return n.__nerve__.schema},enumerable:!1,configurable:!0}),n}(U);return(0,o.s)(r,(0,s.fm)({nerveObjectType:G,masterName:t}),!0),r.__nerve__.schema=vt(r,n),(0,s.z2)(r.__nerve__,"schema"),r}(c,r):r.__nerve__.masterClassGetter&&(u=r.__nerve__.masterClassGetter())}u||(u=H(c,r));var f=(0,p.u9)(r);return Q(e,t,u,n,c,f)}}(t,r,n[r]))})),u}function lt(t){var n={};return t.info=(0,s.fm)(t.info),t.nerveObjectType=nt,t.shadowParent=t.shadowParent||null,t.shadowRoot=t.shadowRoot||n,(0,s.EA)(t,"sourceFieldSet",(function(){var n=t.subFields.toArray().filter((function(t){return!t.__nerve__.info.Attributes.IsLocalField}));return new u(n)})),(0,s.EA)(t,"sourceName",(function(){return t.info.Attributes.SourceFieldName||t.info.Name})),(0,s.EA)(t,"sourceNameToClientName",(function(){var n={};return t.sourceFieldSet.toArray().forEach((function(t){n[t.__nerve__.sourceName]=t.__nerve__.info.Name})),Object.freeze(n)})),(0,s.EA)(t,"subFields",(function(){var t=new u;return Object.keys(n).forEach((function(r){t.addFieldSchema(n[r])})),t})),(0,s.EA)(t,"allContainedFields",(function(){var t=new u([n]);return Object.keys(n).forEach((function(r){var i=n[r];t.addFieldSchemas(i.__nerve__.allContainedFields)})),t})),(0,s.EA)(t,"asEnum",(function(){return!!t.enumType&&!t.info.Attributes.IsNumberTypeInDataSource})),(0,s.EA)(t,"enumType",(function(){return t.enumTypeGetter&&t.enumTypeGetter()})),t.info.IsLeaf?(0,s.EA)(t,"getKey",(function(){return(0,e.hu)(t.getKeyForReferenceType,"getKey has been called but no keyGetter specified for "+t.info.Path),t.getKeyForReferenceType})):(0,s.EA)(t,"getKey",(function(){var n=t.keyFields.toArray().map(ot).sort();return(0,e.hu)(n.length>0,"getKey has been called but there's no key fields of "+t.info.Path),function(t){var r=n;if(t instanceof W){var i=t.__nerve__.master;if(q(i)){var e=i;if(!(r=n.filter((function(t){return e.isFieldReady(t)}))).length)return}}var u={};return r.forEach((function(n){return u[n]=t[n]})),JSON.stringify(u)}})),(0,s.EA)(t,"getKeyFromSourceData",(function(){var n=t.keyFields.toArray(),r=t.sourceNameToClientName,i=n.map((function(t){return t.__nerve__.sourceName}));return function(n){var e={};return i.forEach((function(t){var i=r[t];e[i]=n[t]})),t.getKey(e)}})),(0,s.EA)(t,"keyFields",(function(){return new u(t.subFields.toArray().filter((function(t){return t.__nerve__.info.Attributes.IsKeyField})))})),t.info.IsLeaf?(0,s.EA)(t,"withKey",(function(){return!!t.getKeyForReferenceType})):(0,s.EA)(t,"withKey",(function(){return t.keyFields.Count>0})),(0,o.s)(n,t),(0,s.zO)(n,"toJSON",(function(){return"[Nerve] FieldSchema: ("+t.info.Path+")>"}),!1),t.info.IsCollection&&(0,s.zO)(n,"length",1,!1),gt[t.info.FieldId]=n,n}function dt(t,n){return t+"/"+n}function bt(){return(mt++).toString()}var mt=1,gt={},yt=function(t){function n(){var n=t.call(this,{InitialData:{InProcess:!1,AllSucceeded:!0,Scheduled:!1,CreationError:null,CreationFailed:!1,CreationInProcess:!1,CreationRetryScheduled:!1,CreationScheduled:!1,QueryError:null,QueryFailed:!1,QueryInProcess:!1,UpdateError:null,UpdateFailed:!1,UpdateInProcess:!1,UpdateRetryScheduled:!1,UpdateScheduled:!1}})||this;return n.addRule(wt),n.addRule(pt),n.addRule(St),n}return(0,i.ZT)(n,t),n}(H("Nerve.ObjectSynchronizerMaster",{InProcess:p.J4.boolean(),AllSucceeded:p.J4.boolean(),Scheduled:p.J4.boolean(),CreationError:p.J4.reference(),CreationFailed:p.J4.boolean(),CreationInProcess:p.J4.boolean(),CreationScheduled:p.J4.boolean(),CreationRetryScheduled:p.J4.boolean(),QueryError:p.J4.reference(),QueryFailed:p.J4.boolean(),QueryInProcess:p.J4.boolean(),UpdateError:p.J4.reference(),UpdateFailed:p.J4.boolean(),UpdateInProcess:p.J4.boolean(),UpdateRetryScheduled:p.J4.boolean(),UpdateScheduled:p.J4.boolean()})),wt={Name:"InProcess",InterestedFields:[yt.Schema.CreationInProcess,yt.Schema.QueryInProcess,yt.Schema.UpdateInProcess],onChange:function(t){var n=t.Master.Model;n.InProcess=n.CreationInProcess||n.QueryInProcess||n.UpdateInProcess}},pt={Name:"AllSucceeded",InterestedFields:[yt.Schema.CreationFailed,yt.Schema.QueryFailed,yt.Schema.UpdateFailed],onChange:function(t){var n=t.Master.Model;n.AllSucceeded=!(n.CreationFailed||n.QueryFailed||n.UpdateFailed)}},St={Name:"Scheduled",InterestedFields:[yt.Schema.CreationScheduled,yt.Schema.CreationRetryScheduled,yt.Schema.UpdateScheduled,yt.Schema.UpdateRetryScheduled],onChange:function(t){var n=t.Master.Model;n.Scheduled=n.CreationScheduled||n.CreationRetryScheduled||n.UpdateScheduled||n.UpdateRetryScheduled}},Ot=function(){function t(t){t?(this.Kt=new jt({retry:t.retryForCreation&&t.retryForCreation.bind(t),cancel:t.cancelRetryForCreation&&t.cancelRetryForCreation.bind(t)}),this.Rt=new jt({retry:t.retryForUpdate&&t.retryForUpdate.bind(t),cancel:t.cancelRetryForUpdate&&t.cancelRetryForUpdate.bind(t)})):(this.Kt=new jt,this.Rt=new jt),this.xt=t||{}}var n=t.prototype;return n.scheduleUpdate=function(){return this.Gt?(this.xt.postponeUpdate&&this.xt.postponeUpdate(),this.Gt.promise()):this.Ut()},n.postponeUpdate=function(){this.xt.postponeUpdate&&this.xt.postponeUpdate()},n.flush=function(){this.Kt.flush(),this.Rt.flush(),this.Lt&&(this.Lt.cancel(),this.Lt=void 0,this.xt.cancelUpdate&&this.xt.cancelUpdate()),this.Gt&&(this.Gt.resolve(),this.Gt=void 0)},n.cancelUpdate=function(){this.Gt&&(this.Gt.reject(),this.Gt=void 0,this.xt.cancelUpdate&&this.xt.cancelUpdate())},n.retryForCreation=function(t){return this.Kt.retry(t)},n.cancelRetryForCreation=function(){return this.Kt.cancel()},n.retryForUpdate=function(t){return this.Rt.retry(t)},n.cancelRetryForUpdate=function(){return this.Rt.cancel()},n.Ut=function(){var t=this;this.Gt||(this.Gt=new s.wU);var n,r=this.Gt;return n=this.xt.scheduleUpdate?this.xt.scheduleUpdate():Promise.resolve(),this.Lt=new s.uG(n),this.Lt.promise().finally((function(){t.Gt=void 0,t.Lt=void 0})).then((function(){r.resolve()}),(function(){r.reject(new Error("this.cancelableUpdateSchedule rejected."))})),r.promise()},t}(),jt=function(){function t(t){this.xt=t||{}}var n=t.prototype;return n.retry=function(t){var n=this;return this.xt.retry?(this.cancel(),this.zt=new s.uG(this.xt.retry(t)),this.Qt=new Promise((function(t,r){n._t=t,n.Jt=r})),this.zt.promise().finally((function(){n.Qt=void 0,n.zt=void 0})).then(this._t,this.Jt),this.Qt):Promise.reject("Scheduler has no retry.")},n.flush=function(){this.zt&&(this.zt.cancel(),this.zt=void 0,this.xt.cancel&&this.xt.cancel()),this.Qt&&(this.Qt=void 0,this._t())},n.cancel=function(){this.zt&&(this.zt.cancel(),this.Qt=void 0,this.zt=void 0,this.xt.cancel&&this.xt.cancel())},t}(),It=function(t){function n(n,r,i,e,u){var o=t.call(this)||this;o.Bt=new s.wU,o.Vt=new s.wU,o.Wt={},o.Zt={},o.qt={},o.Ht=Promise.resolve(),o.Xt=0,o.Yt=[],o.C=n,o.xt=new Ot(i.Scheduler),o.$t();var c=r.Reserved&&r.Reserved.ParentExistingInDataSource;o.tn=(0,s.GP)(r.MasterTreeReady,e,c).then((function(){return u(n,(function(t){return o.onSourceDataReceived(t)}),i.DataSourceContext)}));var f=o.nn(r);if(f.length){var h=(0,s.Je)();f.forEach((function(t){o.Wt[t]=!0,o.Zt[t]=h}))}return e.then((function(){n.observe((function(t){t.UpdateNeeded&&o.rn()}))})),!r.ExistingInDataSource?o.en():(o.un=new s.bC(e),e.then((function(){return o.rn()}))),o}(0,i.ZT)(n,t);var r=n.prototype;return r.flush=function(){var t=this;return this.xt.flush(),this.un.promise().then((function(){return t.Vt.promise()}))},r.existingInDataSource=function(){return this.un.promise()},r.existingInDataSourcePromiseState=function(){return this.un.states()},r.deletedFromDataSource=function(){var t=this;return this.un.promise().then((function(){return t.Bt.promise()}),(function(){return Promise.resolve()}))},r.isFieldReady=function(t){t=this.C.getRelatedSourceFields([t])[0];var n=ot($(this.C,[t])[0]);return!!this.Wt[n]},r.ensureFieldsReady=function(t){var n=this;t=this.C.getRelatedSourceFields(t);var r=$(this.C,t);return r.filter((function(t){return!n.isFieldReady(t)})).length?this.un.promise().then((function(){var t=r.filter((function(t){return!n.isFieldReady(t)}));if(t.length)return n.query(t)})).then((function(){return n.on()})):Promise.resolve()},r.forceFieldsReady=function(t){var n=this;t=this.C.getRelatedSourceFields(t),$(this.C,t).filter((function(t){return!n.isFieldReady(t)})).forEach((function(t){n.Wt[ot(t)]=!0}))},r.fieldsReady=function(t){var n=this;t=this.C.getRelatedSourceFields(t);var r=$(this.C,t).map(ot).map((function(t){return n.Zt[t]||(n.Zt[t]=new s.wU),n.Zt[t].promise()}));return Promise.all(r).then((function(){return n.on()}))},r.query=function(t){var n=this;t=this.C.getRelatedSourceFields(t);var r=$(this.C,t);return this.un.promise().then((function(){var t=[],i=new s.wU,e=new s.bC(i.promise().then((function(){return n.cn(t)}))),u=[];return r.filter((function(t){return!t.__nerve__.info.Attributes.IsLocalField})).forEach((function(r){var i=ot(r),o=n.qt[i];o&&o.states()===s.Cb.Pending||(n.qt[i]=e,t.push(r.__nerve__.sourceName)),u.push(n.qt[i].promise())})),t.length?i.resolve():i.reject(new Error("FieldNamesToQuery is empty.")),Promise.all(u)})).then((function(){return n.on()}))},r.onSourceDataReceived=function(t){var n=this,r=at(t,this.C.Schema);return this.Yt.push(r),this.Ht.then((function(){return n.sn()}))},r.onDeletedInDataSource=function(){this.fn().ExistingInSource=!1,this.C.Deleted=!0},r.setFieldsQueryJob=function(t,n){var r=this,i=$(this.C,this.C.getRelatedSourceFields(t)).filter((function(t){return!t.__nerve__.info.Attributes.IsLocalField})),e=new s.wU,u=e.promise().then((function(){return n})).then((function(t){var n={};return i.map((function(t){return t.__nerve__.sourceName})).forEach((function(r){return n[r]=t[r]})),r.onSourceDataReceived(n)}));i.map(ot).forEach((function(t){var n=r.qt[t];n&&n.states()===s.Cb.Pending?r.qt[t]=new s.bC((0,s.Ko)(n.promise(),u)):r.qt[t]=new s.bC(u)})),e.resolve()},r.markFieldsAsReady=function(t,n){var r=this;t.forEach((function(t){return r.Wt[t]=!0})),n.then((function(){var n=(0,s.Je)();t.forEach((function(t){r.Zt[t]?r.Zt[t].resolve():r.Zt[t]=n}))}))},r.$t=function(){var t=this;this.Vt=(0,s.Je)(),this.observe((function(){return t.hn()}),[this.Schema.UpdateError,this.Schema.UpdateFailed,this.Schema.UpdateInProcess,this.Schema.UpdateScheduled])},r.hn=function(){var t=this.Model;t.UpdateScheduled||t.UpdateInProcess?this.Vt.states()!==s.Cb.Pending&&(this.Vt=new s.wU):t.UpdateFailed?t.UpdateRetryScheduled||this.Vt.reject(t.UpdateError):this.Vt.resolve()},r.nn=function(t){var n=this.C.Schema.__nerve__.subFields;if(t.ExistingInDataSource){var r=t.InitialData||{},i=[];return n.toArray().forEach((function(t){var n=ot(t);(t.__nerve__.info.Attributes.IsLocalField||n in r)&&i.push(n)})),i}return n.toArray().filter((function(t){return!t.__nerve__.info.Attributes.IsSourceGenerated})).map(ot)},r.rn=function(){var t=this;this.fn().isDirty()?(this.bulkEdit((function(){t.Model.UpdateScheduled=!0})),(0,s.GP)(this.un.promise(),this.xt.scheduleUpdate()).then((function(){t.Xt=0,t.an()}),(function(){}))):(this.xt.cancelUpdate(),this.Model.UpdateScheduled=!1)},r.an=function(){if(this.vn)this.ln=!0;else if(this.fn().isDirty()){if(this.dn(),this.fn().isDirty())return this.C.__nerve__.deleted?this.mn():this.gn();(0,e.ZK)("onUpdateStart changes dirtiness."),this.yn()}else this.yn()},r.fn=function(){return this.C.__nerve__.dirtyChecker},r.en=function(){var t=this,n=this.C,r=new Promise((function(r,i){t.bulkEdit((function(){t.Model.CreationScheduled=!0,t.tn.then((function(e){var u=function(){if(t.xt.cancelRetryForCreation(),n.__nerve__.deleted)return t.bulkEdit((function(){t.Model.CreationFailed=!1,t.Model.CreationInProcess=!1,t.Model.CreationRetryScheduled=!1,t.Model.CreationScheduled=!1}));t.bulkEdit((function(){t.Model.CreationError=null,t.Model.CreationFailed=!1,t.Model.CreationInProcess=!0,t.Model.CreationRetryScheduled=!1,t.Model.CreationScheduled=!1}));var c=t.fn(),s=c.getDelta()||{},f=c.getSnapshotToUpdate(),h=t.Ht.then((function(){return e.add(s,{Master:n,Snapshot:f})})).then((function(i){n.bulkEdit((function(){c.ExistingInSource=!0,c.setSourceData(s),i&&t.wn(i)})),t.bulkEdit((function(){t.Model.CreationInProcess=!1,t.rn()})),r()})).catch((function(n){t.bulkEdit((function(){t.Model.CreationFailed=!0,t.Model.CreationError=n,t.Model.CreationInProcess=!1,t.Model.CreationRetryScheduled=!0,t.xt.retryForCreation(++o).then(u).catch((function(){t.Model.CreationRetryScheduled=!1,i(n)}))}))}));t.pn(h)},o=0;u()}))}))}));this.un=new s.bC(r)},r.mn=function(){var t=this,n=this.fn(),r=this.Ht.then((function(){return t.tn})).then((function(r){var i=n.getSnapshotToUpdate();return r.delete(i,{Master:t.C,Snapshot:i})})).then((function(){return n.ExistingInSource=!1}));return this.pn(r),r.then((function(n){return t.yn(!1),t.Bt.resolve(),n})).catch((function(n){throw t.Sn(n,!1,(function(){t.Bt.reject(n)})),n}))},r.cn=function(t){var n=this,r=this.Ht.then((function(){return n.tn})).then((function(r){return n.bulkEdit((function(){n.Model.QueryError=null,n.Model.QueryInProcess=!0})),r.query(t,{Master:n.C,Snapshot:null})})).then((function(r){if(r){var i={};Object.keys(r).concat(t).forEach((function(t){return i[t]=r[t]})),n.wn(i)}}));return this.pn(r),r.then((function(){n.Model.QueryInProcess=!1})).catch((function(t){throw n.bulkEdit((function(){n.Model.QueryError=t,n.Model.QueryInProcess=!1})),t}))},r.gn=function(){var t=this,n=this.fn(),r=n.getDelta(),i=n.getSnapshotToUpdate(),u=n.getSourceData();null==r&&(0,e.ZK)("data is null when it's dirty.");var o=this.Ht.then((function(){return t.tn})).then((function(n){return n.update(r,{Master:t.C,Snapshot:i,ValuesBefore:u})})).then((function(i){t.C.bulkEdit((function(){n.setSourceData(r),i&&t.wn(i)}))}));return this.pn(o),o.then((function(){return t.yn(!0)})).catch((function(n){throw t.Sn(n,!0),n}))},r.dn=function(){var t=this;this.vn=!0,this.ln=!1,this.xt.cancelRetryForUpdate(),this.bulkEdit((function(){t.Model.UpdateError=null,t.Model.UpdateFailed=!1,t.Model.UpdateInProcess=!0,t.Model.UpdateRetryScheduled=!1,t.Model.UpdateScheduled=!1}))},r.yn=function(t){var n=this;this.vn=!1,this.Xt=0,this.xt.cancelRetryForUpdate(),this.bulkEdit((function(){n.Model.UpdateError=null,n.Model.UpdateFailed=!1,n.Model.UpdateInProcess=!1,n.Model.UpdateRetryScheduled=!1,n.Model.UpdateScheduled=!1,t&&(n.ln?n.an():n.rn())}))},r.Sn=function(t,n,r){var i=this;this.fn().isDirty()?(this.vn=!1,this.bulkEdit((function(){i.Model.UpdateError=t,i.Model.UpdateFailed=!0,i.Model.UpdateInProcess=!1,i.Model.UpdateRetryScheduled=!0,i.Model.UpdateScheduled=!0,n&&i.ln?i.an():i.xt.retryForUpdate(++i.Xt).then((function(){return i.an()})).catch((function(){i.bulkEdit((function(){i.Model.UpdateRetryScheduled=!1,i.Model.UpdateScheduled=!1})),r&&r()}))}))):this.yn()},r.wn=function(t){var n=at(t,this.C.Schema);this.fn().onSourceDataReceived(n)},r.pn=function(t){var n=this;this.Ht=(0,s.Bx)(t).then((function(){return n.sn()}))},r.sn=function(){var t=this.fn(),n=this.Yt;this.Yt=[],this.C.bulkEdit((function(){n.forEach((function(n){return t.onSourceDataReceived(n)}))}))},r.on=function(){return this.C.__nerve__.changeManager.getChangingPeriod()},n}(yt);J.ObjectSynchronizer=It;var Ft=function(){function t(){}t.prototype;return t.getSubFieldSchemas=function(t){return function(t){return it(t),t.__nerve__.subFields.toArray()}(t)},t.convertFromSourceData=function(t,n){return ft(t,n)},t.convertToSourceData=function(t,n){return ht(t,n)},t.convertToArray=function(t){return(0,s.L)(t)},t.getFieldSchemaInfo=function(t){return et(t)},t.getObjectMasterFromModel=function(t){return f(t)},t.getCollectionMasterFromModel=function(t){return f(t)},t.createObjectMasterClass=function(t,n,r){return H(t,n,r)},t.isObjectMasterClass=function(t){return function(t){var n=t;return!!n.__nerve__&&n.__nerve__.nerveObjectType===Z}(t)},t}();(0,s.z2)(Ft,"convertToArray"),(0,s.z2)(Ft,"getFieldSchemaInfo"),(0,s.z2)(Ft,"getSubFieldSchemas"),(0,s.z2)(Ft,"convertFromSourceData"),(0,s.z2)(Ft,"convertToSourceData"),(0,s.z2)(Ft,"createObjectMasterClass"),(0,s.z2)(Ft,"getObjectMasterFromModel"),(0,s.z2)(Ft,"getCollectionMasterFromModel"),(0,s.z2)(Ft,"isObjectMasterClass");var Ct={addItems:null,deleteItems:null,getIndexWithKeyFields:null,getItemWithKeyFields:null,itemsAddedInSource:null,itemsDeletedInSource:null,markAsChanged:null,setComparer:null};for(var Pt in Ct)Ct[Pt]=Mt(Pt);function Mt(t){return function(n){for(var r=[],i=1;i<arguments.length;i++)r[i-1]=arguments[i];var e=Ft.getCollectionMasterFromModel(n),u=e[t];return u.apply(e,r)}}Ft.Collection=Object.freeze(Ct),(0,s.z2)(Ft,"Collection")}}]);